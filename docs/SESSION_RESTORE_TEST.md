# 会话恢复功能测试指南

## 测试目的
验证应用能够正确保存和恢复所有用户状态，确保用户在重启应用后可以无缝继续之前的工作。

## 测试前准备

### 1. 清空现有状态
在浏览器控制台执行：
```javascript
localStorage.removeItem('minigis_last_session');
```

### 2. 准备测试数据
- 准备 2-3 个 Shapefile 文件
- 确保文件路径已知且可访问

## 测试步骤

### 测试 1: 地图位置保存
**目的**：验证地图位置和缩放级别能够正确保存和恢复

1. 启动应用
2. 移动地图到特定位置（如北京、上海等）
3. 调整缩放级别到特定级别（如 zoom=12）
4. 等待 2 秒（确保自动保存完成）
5. **重启应用**
6. **验证**：地图应该恢复到相同位置和缩放级别

✅ **通过条件**：地图中心点和缩放级别与关闭前一致

---

### 测试 2: 图层状态保存
**目的**：验证图层信息、可见性、样式等能够正确恢复

1. 启动应用
2. 添加 2-3 个数据图层
3. 修改图层状态：
   - 隐藏第2个图层
   - 调整第1个图层透明度为 0.7
   - 修改第3个图层样式（填充色、描边色）
4. 等待 3 秒
5. **重启应用**
6. **验证**：
   - 所有图层都已恢复
   - 图层可见性正确
   - 透明度设置正确
   - 样式配置正确

✅ **通过条件**：图层列表、顺序、可见性、透明度、样式与关闭前一致

---

### 测试 3: 符号系统保存
**目的**：验证符号化配置能够正确保存和恢复

1. 启动应用
2. 添加一个矢量图层
3. 打开符号面板
4. 配置符号：
   - 点图层：选择特定符号、颜色、大小
   - 线图层：设置线宽、颜色、样式
   - 面图层：设置填充色、描边色
5. 应用符号
6. 等待 3 秒
7. **重启应用**
8. **验证**：符号配置已恢复，地图上显示正确的符号

✅ **通过条件**：符号样式与关闭前一致

---

### 测试 4: 标注配置保存
**目的**：验证标注配置能够正确保存和恢复

1. 启动应用
2. 添加一个矢量图层
3. 打开标注面板
4. 配置标注：
   - 选择标注字段
   - 设置字体大小：16
   - 设置字体颜色：红色
   - 启用光晕：白色，宽度2
5. 应用标注
6. 等待 3 秒
7. **重启应用**
8. **验证**：标注配置已恢复，地图上显示正确的标注

✅ **通过条件**：标注配置和显示效果与关闭前一致

---

### 测试 5: 坐标系保存
**目的**：验证当前坐标系能够正确保存和恢复

1. 启动应用
2. 打开坐标系面板
3. 切换到 CGCS2000（如 EPSG:4490）
4. 等待 1 秒
5. **重启应用**
6. **验证**：坐标系面板显示为 CGCS2000

✅ **通过条件**：坐标系与关闭前一致

---

### 测试 6: 底图配置保存
**目的**：验证用户选择的底图能够正确保存和恢复

1. 启动应用
2. 在图层面板中：
   - 隐藏默认底图的注记层
   - 或者添加新的底图
3. 等待 3 秒
4. **重启应用**
5. **验证**：底图配置已恢复

✅ **通过条件**：底图配置与关闭前一致

---

### 测试 7: UI 布局保存
**目的**：验证面板状态能够正确保存和恢复

1. 启动应用
2. 修改UI布局：
   - 折叠左侧图层面板
   - 展开右侧属性面板
   - 展开底部面板
   - 调整右侧面板宽度
3. 等待 2 秒
4. **重启应用**
5. **验证**：
   - 左侧面板为折叠状态
   - 右侧面板为展开状态
   - 底部面板为展开状态
   - 面板尺寸正确

✅ **通过条件**：UI布局与关闭前一致

---

### 测试 8: 属性表状态保存
**目的**：验证属性表的打开状态能够正确恢复

1. 启动应用
2. 添加 2 个数据图层
3. 打开两个图层的属性表
4. 切换到第2个图层的属性表标签页
5. 等待 3 秒
6. **重启应用**
7. **验证**：
   - 两个属性表都已打开
   - 当前激活的是第2个图层的属性表

✅ **通过条件**：属性表打开状态和激活标签页与关闭前一致

---

### 测试 9: 文件不存在容错
**目的**：验证当保存的图层文件不存在时的容错处理

1. 启动应用
2. 添加 2 个图层
3. 等待自动保存
4. **手动删除或移动其中一个图层文件**
5. **重启应用**
6. **验证**：
   - 存在的图层正常恢复
   - 不存在的图层被跳过
   - 显示警告信息，但应用正常运行
   - 不显示错误对话框

✅ **通过条件**：应用正常启动，可用图层正常恢复

---

### 测试 10: 完整工作流程
**目的**：验证真实使用场景的完整恢复

1. 启动应用
2. 执行完整工作流程：
   - 移动地图到工作区域
   - 添加 3 个图层
   - 配置第1个图层的符号
   - 配置第2个图层的标注
   - 调整图层透明度
   - 切换到 CGCS2000 坐标系
   - 打开第1个图层的属性表
   - 折叠右侧面板
3. 等待 5 秒
4. **重启应用**
5. **验证**：所有状态都正确恢复

✅ **通过条件**：整个工作状态完整恢复

---

## 性能测试

### 测试 11: 大量图层恢复性能
**目的**：验证恢复大量图层时的性能

1. 添加 10 个图层
2. 配置各种样式和标注
3. 重启应用
4. **测量**：恢复时间

✅ **通过条件**：恢复时间 < 5 秒

---

### 测试 12: 保存性能
**目的**：验证自动保存不影响用户操作

1. 连续快速操作：
   - 移动地图
   - 切换图层可见性
   - 调整透明度
2. **观察**：是否有卡顿

✅ **通过条件**：操作流畅，无明显卡顿

---

## 浏览器兼容性测试

在以下浏览器中执行基础测试（测试 1-5）：
- [ ] Chrome/Edge
- [ ] Firefox
- [ ] Safari（如果可用）

---

## 问题记录

测试过程中发现的问题：

| 测试编号 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|------|
|         |         |         |      |

---

## 测试结论

- **测试日期**：
- **测试人员**：
- **通过的测试**：__/12
- **失败的测试**：__/12
- **总体评价**：

---

## 调试技巧

### 查看保存的状态
在浏览器控制台执行：
```javascript
JSON.parse(localStorage.getItem('minigis_last_session'))
```

### 监控自动保存
在浏览器控制台执行：
```javascript
const original = localStorage.setItem;
localStorage.setItem = function(key, value) {
  if (key === 'minigis_last_session') {
    console.log('State saved at:', new Date().toLocaleTimeString());
  }
  return original.apply(this, arguments);
};
```

### 清除特定状态
```javascript
// 只清除图层状态
const state = JSON.parse(localStorage.getItem('minigis_last_session'));
state.layers = [];
localStorage.setItem('minigis_last_session', JSON.stringify(state));
```
