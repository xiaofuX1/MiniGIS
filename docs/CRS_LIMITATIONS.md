# 坐标系功能限制说明

## 当前状态

### ✅ 已实现功能

1. **地理坐标系切换**
   - 支持 WGS84 (EPSG:4326)
   - 支持 CGCS2000 (EPSG:4490)
   - 地理坐标系之间可以自由切换

2. **坐标系识别**
   - 自动识别数据源坐标系
   - 保存图层的原始坐标系信息
   - 在面板中显示图层坐标系

3. **基础投影功能**
   - proj4 坐标系注册完成
   - OpenLayers 投影引擎集成完成

### ⚠️ 暂时禁用功能

1. **投影坐标系应用**
   - CGCS2000 3度带投影坐标系（EPSG:4513-4533）
   - CGCS2000 6度带投影坐标系（EPSG:4491-4512）
   - 中央经线命名的投影坐标系（EPSG:4534-4554）

2. **原因**
   - 投影坐标系的地图渲染需要进一步调优
   - 底图在投影坐标系下的变形问题
   - 测量功能在投影坐标系下的精度问题

### 🚧 待完善内容

#### 1. 投影坐标系渲染优化
```typescript
// 需要优化的问题：
// - 投影坐标系的初始视图范围设置
// - 底图瓦片在投影坐标系下的重投影性能
// - 不同投影坐标系之间的切换流畅度
```

#### 2. 底图适配
```typescript
// 底图问题：
// - Web墨卡托底图在投影坐标系下变形严重
// - 需要提供适合投影坐标系的底图选项
// - 或者在投影坐标系模式下隐藏底图
```

#### 3. 测量工具适配
```typescript
// 测量工具需要根据地图投影调整：
// - 投影坐标系下应该使用平面距离计算
// - 地理坐标系下使用球面距离计算
// - 坐标测量需要显示正确的单位（米/度）
```

#### 4. 数据加载策略
```typescript
// 需要优化的数据加载：
// - 大数据在投影转换时的性能
// - 跨带数据的处理策略
// - 数据范围与投影范围的匹配
```

## UI 提示

### CRSPanel 和 CRSDialog
- 投影坐标系选项显示但禁用
- 选择投影坐标系时显示警告信息
- 应用按钮对投影坐标系禁用

### 警告信息
```
投影坐标系功能待完善
当前仅支持地理坐标系（CGCS2000、WGS84），投影坐标系功能正在开发中。
```

## 代码修改位置

### 1. MapView.tsx
```typescript
// 地图初始化 - 固定使用地理坐标系
const mapProjection = currentCRS.type === 'geographic' ? currentCRS.code : 'EPSG:4326';

// 坐标系变化监听 - 过滤投影坐标系
if (currentCRS.type !== 'geographic') {
  console.warn('[坐标系变更] 投影坐标系功能待完善，忽略此次变更');
  return;
}
```

### 2. CRSPanel.tsx & CRSDialog.tsx
```typescript
// 应用按钮禁用逻辑
const handleApply = () => {
  if (selectedCRS.type === 'projected') {
    message.warning('投影坐标系功能待完善，暂时仅支持地理坐标系');
    return;
  }
  // ...
};

// 按钮禁用属性
disabled={selectedCRS.code === currentCRS.code || selectedCRS.type === 'projected'}
```

## 未来改进方向

### 阶段一：基础投影坐标系支持
1. 修复投影坐标系的视图范围问题
2. 优化投影转换性能
3. 测试常用投影坐标系的稳定性

### 阶段二：完整功能支持
1. 支持自定义投影范围
2. 提供投影坐标系专用底图
3. 完善测量工具的投影适配

### 阶段三：高级功能
1. 支持自定义坐标系定义
2. 坐标系转换参数设置
3. 投影变形可视化

## 测试要求

在启用投影坐标系功能前，需要通过以下测试：

### 必须测试项
- [ ] 投影坐标系初始视图正确显示
- [ ] 地理数据正确投影到投影坐标系
- [ ] 不同投影坐标系之间切换流畅
- [ ] 底图在投影坐标系下可接受或可隐藏
- [ ] 测量工具在投影坐标系下精度正确
- [ ] 要素选择和高亮在投影坐标系下正常

### 性能测试
- [ ] 大数据量图层的投影转换性能
- [ ] 频繁切换坐标系的响应速度
- [ ] 内存使用稳定性

## 用户引导

当用户尝试使用投影坐标系时：
1. 显示清晰的警告信息
2. 说明当前仅支持地理坐标系
3. 提示功能正在开发中
4. 不影响用户继续使用地理坐标系功能

## 开发建议

1. **优先级**：先完善地理坐标系功能，确保稳定性
2. **渐进式**：逐步启用投影坐标系，从简单场景开始
3. **用户反馈**：收集用户对投影坐标系的需求
4. **文档完善**：提供详细的投影坐标系使用文档
